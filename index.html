<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>K-Pop Stars: The Game (2D Version)</title>
    <style>
        body { margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background: #111; overflow: hidden; font-family: 'Arial', sans-serif; }
        #container { position: relative; max-height: 98vh; aspect-ratio: 9 / 16; width: auto; height: 100%; }
        canvas { display: block; width: 100%; height: 100%; border: 2px solid #444; background: #000; cursor: pointer; }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = 720;
        canvas.height = 1280;

        // --- GAME DATA ---
        let money = 2000;
        let gameState = "studio"; // Skips loading for immediate testing
        let selectedArtist = null, selectedMusic = null, selectedDance = null;
        let hiredMei = false;
        let ownedMusic = false;

        const previewAudio = new Audio('music.mp3');

        // --- IMAGE ASSETS ---
        const images = {};
        const sources = {
            cover: 'cover.jpg',
            studio: 'main.jpg',
            studioBtn: 'button_01.png',
            hireBtn: 'hire_bg.png',
            hireBg: 'hire.jpg',
            backBtn: 'back.jpg',
            mei: 'alguien.jpg',
            videoBg: 'video.jpg',
            musicBg: 'music.jpg',
            liveBg: 'play.jpg'
        };

        // Load images safely
        for (let key in sources) {
            images[key] = new Image();
            images[key].src = sources[key];
        }

        // --- INPUT HANDLING ---
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            const mouseX = (e.clientX - rect.left) * (canvas.width / rect.width);
            const mouseY = (e.clientY - rect.top) * (canvas.height / rect.height);

            if (gameState === "studio") {
                if (mouseX >= 40 && mouseX <= 340 && mouseY >= 300 && mouseY <= 460) gameState = "hire";
                if (mouseX >= 380 && mouseX <= 680 && mouseY >= 300 && mouseY <= 460) gameState = "music";
                if (mouseX >= 210 && mouseX <= 510 && mouseY >= 500 && mouseY <= 660 && hiredMei && ownedMusic) gameState = "video";
            } 
            else if (gameState === "hire") {
                if (mouseX >= 560 && mouseY >= 1100) gameState = "studio";
                if (mouseY >= 250 && mouseY <= 450 && !hiredMei && money >= 1000) { money -= 1000; hiredMei = true; }
            } 
            else if (gameState === "music") {
                if (mouseX >= 560 && mouseY >= 1100) { gameState = "studio"; previewAudio.pause(); }
                if (mouseX >= 150 && mouseX <= 400 && mouseY >= 350 && mouseY <= 440) {
                    if (previewAudio.paused) previewAudio.play(); else previewAudio.pause();
                } else if (mouseX >= 450 && mouseX <= 680 && mouseY >= 250 && mouseY <= 450 && !ownedMusic && money >= 500) {
                    money -= 500; ownedMusic = true;
                }
            } 
            else if (gameState === "video") {
                if (mouseX >= 560 && mouseY >= 1100) gameState = "studio";
                if (mouseX >= 185 && mouseX <= 535 && mouseY >= 300 && mouseY <= 460) gameState = "create_video_menu";
            } 
            else if (gameState === "create_video_menu") {
                if (mouseX >= 560 && mouseY >= 1100) gameState = "video";
                if (mouseY >= 280 && mouseY <= 380) selectedArtist = "MEI WAN";
                if (mouseY >= 480 && mouseY <= 580) selectedMusic = "CODIGAMIA REMIX";
                if (mouseY >= 680 && mouseY <= 780) selectedDance = "SALSA DANCE";
                if (mouseY >= 920 && mouseY <= 1080 && selectedArtist && selectedMusic && selectedDance) {
                    gameState = "live"; previewAudio.currentTime = 0; previewAudio.play();
                }
            } 
            else if (gameState === "live") {
                if (mouseX >= 560 && mouseY >= 1100) { gameState = "studio"; previewAudio.pause(); }
            }
        });

        // --- DRAWING LOOP ---
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (gameState === "studio") {
                drawFit(images.studio);
                drawHeader("THE STUDIO");
                ctx.drawImage(images.studioBtn, 40, 300, 300, 160);
                ctx.drawImage(images.studioBtn, 380, 300, 300, 160);
                
                ctx.save(); 
                if (!(hiredMei && ownedMusic)) ctx.filter = "grayscale(1) brightness(0.5)";
                ctx.drawImage(images.studioBtn, 210, 500, 300, 160); 
                ctx.restore();

                ctx.fillStyle = "white"; ctx.font = "bold 35px Arial"; ctx.textAlign = "center";
                ctx.fillText("HIRE", 190, 390); ctx.fillText("MUSIC", 530, 390); ctx.fillText("VIDEO", 360, 590);
            } 
            else if (gameState === "hire") {
                drawFit(images.hireBg); drawHeader("HIRE TALENT");
                ctx.drawImage(images.hireBtn, 20, 250, 680, 200);
                ctx.drawImage(images.mei, 30, 260, 180, 180);
                ctx.fillStyle = "white"; ctx.textAlign = "left"; ctx.font = "bold 24px Arial";
                ctx.fillText("NAME: MEI WAN", 220, 300);
                if (hiredMei) { ctx.fillStyle = "#00FF00"; ctx.fillText("HIRED", 570, 360); }
                else { ctx.fillStyle = "white"; ctx.fillText("HIRE: 1000$", 540, 360); }
                ctx.drawImage(images.backBtn, 560, 1100, 120, 120);
            } 
            else if (gameState === "music") {
                drawFit(images.musicBg); drawHeader("MUSIC STUDIO");
                ctx.save(); if (ownedMusic) ctx.filter = "hue-rotate(90deg)";
                ctx.drawImage(images.hireBtn, 20, 250, 680, 200); ctx.restore();
                ctx.fillStyle = "white"; ctx.textAlign = "left"; ctx.font = "bold 24px Arial";
                ctx.fillText("CODIGAMIA REMIX", 50, 310);
                ctx.fillText(previewAudio.paused ? "PREVIEW ▶" : "STOP ■", 180, 400);
                if (ownedMusic) { ctx.fillStyle = "white"; ctx.fillText("OWNED", 570, 360); }
                else { ctx.fillStyle = "white"; ctx.fillText("BUY: 500$", 570, 360); }
                ctx.drawImage(images.backBtn, 560, 1100, 120, 120);
            }
            else if (gameState === "video" || gameState === "create_video_menu") {
                drawFit(images.videoBg); drawHeader(gameState === "video" ? "VIDEO PRODUCTION" : "NEW RELEASE");
                if (gameState === "video") {
                    ctx.drawImage(images.studioBtn, 185, 300, 350, 160);
                    ctx.fillStyle = "white"; ctx.textAlign = "center"; ctx.fillText("CREATE VIDEO", 360, 390);
                } else {
                    ctx.fillStyle = "white"; ctx.textAlign = "left"; ctx.font = "bold 30px Arial";
                    ctx.fillText("Artist: " + (selectedArtist || "SELECT"), 100, 350);
                    ctx.fillText("Music: " + (selectedMusic || "SELECT"), 100, 550);
                    ctx.fillText("Dance: " + (selectedDance || "SELECT"), 100, 750);
                    ctx.drawImage(images.studioBtn, 185, 920, 350, 160);
                    ctx.textAlign = "center"; ctx.fillText("UPLOAD", 360, 1010);
                }
                ctx.drawImage(images.backBtn, 560, 1100, 120, 120);
            }
            else if (gameState === "live") {
                drawFit(images.liveBg);
                // Instead of 3D, we show the character portrait dancing (bouncing)
                let bounce = Math.sin(Date.now() / 200) * 20;
                ctx.drawImage(images.mei, 160, 300 + bounce, 400, 400);
                
                ctx.fillStyle = "white"; ctx.textAlign = "left"; ctx.font = "bold 30px Arial";
                ctx.fillText("@" + selectedArtist, 50, 1000);
                ctx.drawImage(images.backBtn, 560, 1100, 120, 120);
            }

            requestAnimationFrame(update);
        }

        // --- HELPERS ---
        function drawFit(img) {
            if (!img.complete || img.naturalWidth === 0) return;
            const ratio = img.width/img.height, cRatio = canvas.width/canvas.height;
            let rw, rh, ox, oy;
            if (ratio > cRatio) { rw = canvas.width; rh = canvas.width/ratio; ox = 0; oy = (canvas.height-rh)/2; }
            else { rh = canvas.height; rw = canvas.height*ratio; ox = (canvas.width-rw)/2; oy = 0; }
            ctx.drawImage(img, ox, oy, rw, rh);
        }

        function drawHeader(title) {
            ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0, 40, canvas.width, 180);
            ctx.fillStyle = "white"; ctx.font = "bold 40px Arial"; ctx.textAlign = "center";
            ctx.fillText(title, canvas.width/2, 100);
            ctx.font = "24px Courier"; ctx.fillText("MONEY: $" + money, canvas.width/2, 160);
        }

        update();
    </script>
</body>
</html>